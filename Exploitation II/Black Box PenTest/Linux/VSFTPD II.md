
Refer to [[VSFTPD]] for basics. 

### Black box testing on Linux FTP 

1. In our case we are performing a black box pentest on a Linux machine.

2. The machine is running a VSFTPD 2.3.4 server on port 21. This version is vulnerable to command execution. 

3. If we take a look at the exploit Python code, we can see that it connects with Telnet through port 6200 at one point, but since the sysadmin has closed the port in the target system, the exploit won't work. 

4. This proves that in some cases, the exploit won't work as they've been patched.

5. Since we are unable to use the exploit to gain access, we can go with bruteforcing FTP credentials.

6. To do this, we can start by enumerating user accounts using SMTP. Knowing the usernames will aid in the brute-forcing process.
```
auxiliary/scanner/smtp/smtp_enum
```

7. After we successfully get the credentials, we can login using FTP.

8. We can see that the target machine is hosting `WebDAV` in the web server. We can upload a PHP reverse shell (Since the system is running Linux) in the `WebDAV` directory and get reverse shell access to the machine. [[WebDAV]]

9. The webshells are stored in `/usr/share/webshells/php`. We'll copy the reverse shell to our pwd. 

10. We'll now open the shell file using a text editor as we need to modify the IP address with our machine IP. 

11. Now we can login back with FTP and  upload the payload in the `/var/www/dav` directory as it is the only directory we have write access to.           

12. Now we can start a `nc` listener to listen for incoming connection from the payload after its run on the target machine. If connection is established, we'll be provided with a bourne shell session. We can upgrade it to a bash session too using `/bin/bash -i`. 
