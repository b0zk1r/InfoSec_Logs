
### Identifying PrivEsc Vulnerabilities 


+ In order to elevate your privileges on Windows, you must first, identify privilege escalation vulnerabilities that exist on the target system.

+ This process will differ greatly based on the type of target you gain access to. Privilege escalation on Windows can be performed through a plethora of techniques based on the version of Windows and the system's unique configuration.

+ This process can be quite tedious and time consuming and as a result, it is recommended to automate the processes of identifying privilege escalation vulnerabilities. This can be done through the use of various automation scripts. 

### What is `PrivescCheck` ?

+ `PrivescCheck` - This `PowerShell` script aims to enumerate common Windows configuration issues that can be leveraged for local privilege escalation. It also gathers various information that might be useful for exploitation and/or post-exploitation. 

+ GitHub Repo: https://github.com/itm4n/PrivescCheck 


### Gaining initial access using `web_delivery` module

1. We can use the `web_delivery` module in `MSF` to gain initial access to the system. This module will create a `meterpreter` payload and host it in a web server. It'll then provide us with a code to be run on the target machine. Upon running the code, the target will automatically install and run the payload which is being hosted in the web server and we should get a `meterpreter` session. 
```
use exploit/multi/script/web_delivery
```

- Set the target to `PSH\ (Binary)`. This will create the code to be sent to the target in `PowerShell`. We can also generate the code in Python or any other language. 
- Set the payload to `windows/shell/reverse_tcp` since we are exploiting a Windows machine. 
- We can also disable the `PowerShell` code to be encoded in Base-64 using `set PSH-EncoddedCommand false`.
- This will provide us with a code in the language we've chosen, which in our case is `PowerShell`.

2. Background the current command shell session. Use `shell_to_meterpreter` module to upgrade the session. 
	+ Use `show advanced` command to see the advanced options.
	+ Change the `WIN_TRANSFER` option to `VBS`.
	+ Make sure that the port in use in this module isn't in conflict with the command shell session. 

3. Upon gaining the `meterpreter` shell access we can migrate to a 64 bit process. 

### How to use `PrivescCheck` ?

1. We'll now assume that we have initial access and the `PrivescCheck.ps1` script has already been uploaded into the target system. 

2. Navigate to the directory where `PrivescCheck.ps1` is installed. Execute the script.
```
powershell -ep bypass -c ". .\PrivescCheck.ps1; Invoke-PrivescCheck"
```

3. The script should enumerate various attack vectors and misconfigurations through which we can escalate our privileges. In our case, the script has discovered Winlogon registry keys containing clear text passwords. 

### Elevating the privileges 

1. Now that we have obtained the clear text passwords from Winlogon, we can use SMB to login as `NT AUTHORITY/SYSTEM`. 

2. We can use `psexec.py` to login with SMB.
```
psexec.py <username>@<target-ip>
```

3. We can also use `MSF` module for `psexec`.
```
use exploit/windows/smb/psexec
```

