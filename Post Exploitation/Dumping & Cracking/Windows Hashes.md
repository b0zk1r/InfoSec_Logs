
### Dumping & Cracking NTLM Hashes

1. To learn the basics about password hashes, refer to [[eJPT Notes/Exploitation/Windows/Credential Dumping/Password Hashes|Password Hashes]]

2. We can dump Windows password hashes by leveraging various utilities like:
	+ The inbuilt meterpreter “hashdump” command
	+ Mimikatz

3. After we have dumped the hashes, we can crack them through the use of the following utilities:
	+ John The Ripper
	+ Hashcat

### How to obtain the `NTLM` hashes ?

1. Gain initial access and migrate to the `lsass` process, this will make our `meterpreter` session more stable in context of accessing the `lsass` process cache. 

2. We can use the `hashdump` command to check the NTLM hashes of all the users in the system. We can also use the `net user` command in the target shell to check whether we've obtained the hashes for all the users in the system. 

3. Now we'll save the hashes we obtained inside a text file. 

### Cracking hashes using `John The Ripper`

1. First we need to provide the format of the Hash (SHA-256, SSH etc.) we want to crack. We can check the available formats:
```
john --list=formats
```
- We can look for a specific format by piping the `grep` command. In our case, `| grep NT`.

2. We can provide any word-list of our choice. John will use it's default word-list, in case we don't provide one.
```
john --format=<hash-format> <hashes-file> --wordlist=<path>
```

3. After successfully cracking the hashes, we can use the password to authenticate using `SSH`, `RDP` or `SMB`. If the cracking fails, we can still utilise the hashes to authenticate via `SMB` using `psexec`.

### Cracking hashes using `HashCat`

1. Use `hashcat --help` to access the `HashCat` help menu. The help menu should be open on a separate terminal for easy access.

2. We need to specify the hash type using  `-m`. It is the equivalent to hash format in `JohnTheRipper`.  It accepts numerical value, so we need to provide the hash type ID. The hash type ID for various hash formats can be found in the help menu. 

3. We also need to provide the attack mode `-a`. In our case, we'll be using Brute-Force. Every attack mode has a different ID. 

4. Lastly, we need to specify the file containing the hashes and the word-list path. 

5. Since in our case we are brute-forcing NTLM hashes we'll choose attack type 3 and hash type 1000.  
```
hashcat -a 3 -m 1000 <hash-file> <wordlist-path>
```

- After gaining the clear text passwords, we can authenticate legitimately through services like RDP using `xfreerdp`. 