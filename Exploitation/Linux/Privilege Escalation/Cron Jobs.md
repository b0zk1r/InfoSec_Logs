
- Linux implements task scheduling through a utility called Cron.

- Cron is a time-based service that runs applications, scripts and other commands repeatedly on a specified schedule.

- An application, or script that has been configured to be run repeatedly with Cron is known as a Cron job. Cron can be used to automate or repeat a wide variety of functions on a system, from daily backups to system upgrades and patches.

- The crontab file is a configuration file that is used by the Cron utility to store and track Cron jobs that have been created.

### Exploiting misconfigured Cron Jobs

- Cron jobs can also be run as any user on the system, this is a very important factor to keep an eye on as we will be targeting Cron jobs that have been configured to be run as the “root” user.

- This is primarily because, any script or command that is run by a Cron job will run as the root user and will consequently provide us with root access.

- In order to elevate our privileges, we will need to find and identify cron jobs scheduled by the root user or the files being processed by the cron job.

- In this scenario, we'll be looking at a cron job that runs a shell script. If that shell script has improper permissions i.e - it can be edited by any user on the system, that means we can essentially input any commands that we would like to be executed into the shell script. And once that cron job is run, that particular shell script along with the command that we inserted will be executed with root privileges.

### How to exploit ?

1. Gain initial access.
2. Use `whoami` to check the username. Check the if the current user is part of the `sudo` group `group <username>`
3. Check which accounts have root privileges `cat /etc/passwd`
4. We can check the cron jobs scheduled for this user using `crontabs -l`
5. To check if there are any cron jobs setup by the root user will require a lot of enumeration and searching. But in this lab the process has been made relatively easier.
6. We can `ls` the contents of the `pwd` and check if there are any files that are created and can only be accessed by the root user. `ls -la`
7. If we find such a file, `cat` it to check if it is accessible by us.
8. In this case, the file is `message` inside `/home/student`
9. Now we will use `grep` to check all the occurrences of the path to the file within a shell script or any other file for that matter.
```
grep -rnw /usr -e "/home/student/message"
```
10. The "grep" command is searching for files inside the "/usr" directory and its subdirectories that contain the specific text pattern `"/home/student/message."` This text pattern can appear in any type of file, whether it's a text file, config file or binary file.
	+ **-r**: This option tells "grep" to perform a recursive search, which means it will search for the pattern not only in the specified directory ("/usr") but also in all its subdirectories.
	+ **-n**: Print the line numbers of the matching lines.
	+ **-w**: Perform a whole-word match. It will only return lines that contain the specified pattern as a whole word, rather than as part of another word.
11. We file path is mentioned inside a `copy.sh` file which seems to be copying the `message` file to the `/tmp` directory.
12. Now that we have discovered the file ran by Cron Job. We can go ahead and look at the permissions of `copy.sh`. It seems that all the users have both read & write perms.
13. Since we have the necessary perms, we will append our code into the `copy.sh` file.
```
printf '#/bin/bash\necho "student ALL=NOPASSWD:ALL" >> /etc/sudoers' > /usr/local/share/copy.sh
```

- The `printf` command is overwriting the `copy.sh` file with the code - 
```
#bin/bash
echo "student ALL=NOPASSWD:ALL" >> /etc/sudoers
```

- The `copy.sh` is supposed to run per minute, when it'll run, it'll append the command `student ALL=NOPASSWD:ALL` to the `sudoers` file.
- This line is attempting to modify the `sudoers` file to grant the "student" user permission to run commands with "sudo" without entering a password.

14. Now we will wait atleast 1 min and run the command `sudo -l` to check the privileges of the current user `student`. 
15. The privileges should now be elevated, and we can confirm that by running `sudo su`. We should become root user without asking for password.
16. We can also use command `cronjob -l` to display the list of scheduled cron jobs for the current user. 