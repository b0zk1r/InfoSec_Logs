
- Linux has multi-user support and as a result, multiple users can access the system simultaneously. This can be seen as both an advantage and disadvantage from a security perspective, in that, multiple accounts offer multiple access vectors for attackers and therefore increase the overall risk of the server.

- All of the information for all accounts on Linux is stored in the passwd file located in: `etc/passwd`

- We cannot view the passwords for the users in the passwd file because they are encrypted and the passwd file is readable by any user on the system.

- All the encrypted passwords for the users are stored in the shadow file. it can be found in the following directory: `/etc/shadow`

- The shadow file can only be accessed and read by the root account, this is a very important security feature as it prevents other accounts on the system from accessing the hashed passwords.

- `passwd` file  contains the users' public information (UID, full name, home directory), while `shadow` contains the hashed password and the password expiry data.

### Linux Password Hashes

The `passwd` file gives us information in regards to the hashing algorithm that is being used and the password hash, this is very helpful as we are able to determine the type of hashing algorithm that's being used and its strength. We can determine this by Looking at the number after the username encapsulated by the dollar symbol ($).

| Value | Hashing Algorithm |
|----------|----------|
| $1 | MD5 |
| $2 | Blowfish |
| $5 | SHA-256 |
| $6 | SHA-512 |


### How to gather the hashes ?

1. Scan the target IP with `nmap` and look for vulnerable services that can be exploited.
2. Use `searchsploit` to scan the service. 
3. Exploit the vulnerability and gain a command shell session using `MSF`.
4. Start `MSF` with `service postgresql start && msfconsole`
5. Type `/bin/bash -i` to open a bash session.
6. We can verify if we have elevated privileges or not using the `id` command, if `uid=0`, then it indicates that we have root access.
7. Background the session using `^Z` shortcut key. 
8. Type `sessions` to check the background sessions. Upgrade the session we put in background to a `meterpreter` session. `sessions -u <session-ID>`
9. We can confirm that we got a `meterpreter` session using `sessions` command again and switch to the session using `sessions <session-id>`.
10. Since we have root access, we can check the contents of `shadow` file. `cat /etc/shadow`
11. Now we can background this session and search for the `hashdump` module.
12. Once we find the appropriate `hashdump` module, we can use it.
```
use post/linux/gather/hashdump
```
12. We can now set `SESSION` option as the ID of the `meterpreter` session. 
13. This will essentially gather the hashed passwords of all the users and save them for us in a specific file.

### How to crack the hash ?

1. Type `creds` inside the `hashdump` module we were in, to check the hashes we found.
2. Type `back` to exit out of the module.
3. Use the following module to crack the hash
```
use auxiliary/analyze/crack_linux
```
4. In our case, we'll be setting  `SHA512` to `true`, as our hash was encrypted in `SHA512`.
5. Now we can type `run` and the password will be cracked for us.

*Running the `postgresql` server along with `msfconsole` is mandatory for running the `crack_linux` module.*